[program:langchain-server]
; 项目根目录
directory=/mnt/data/langchain-v2.0

; 启动命令 - 使用 Gunicorn 多 Worker 模式
; -w 4: 启动 4 个 Worker 进程 (建议设置为 CPU 核心数 * 2 + 1)
; -k uvicorn.workers.UvicornWorker: 使用 Uvicorn 异步 Worker
; --timeout 120: 设置超时时间，防止 LLM 生成过慢导致连接断开
command=/home/bupt/Server_Project_ZH/venv/bin/gunicorn server:app -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:50018 --timeout 120

; 进程管理
autostart=true
autorestart=true
startsecs=10
stopwaitsecs=10

; 日志配置
stderr_logfile=/mnt/data/langchain-v2.0/logs/server.err.log
stdout_logfile=/mnt/data/langchain-v2.0/logs/server.out.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=10

; 环境变量
environment=PORT=50018,HOST="0.0.0.0",PYTHONUNBUFFERED=1,DJANGO_PROJECT_ROOT="/home/bupt/Server_Project_ZH"

; --- 新增：独立清理服务 ---
[program:langchain-cleanup]
directory=/mnt/data/langchain-v2.0
command=/home/bupt/Server_Project_ZH/venv/bin/python scripts/cleanup_task.py
autostart=true
autorestart=true
stderr_logfile=/mnt/data/langchain-v2.0/logs/cleanup.err.log
stdout_logfile=/mnt/data/langchain-v2.0/logs/cleanup.out.log
environment=PYTHONUNBUFFERED=1
